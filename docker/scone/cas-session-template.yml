name: $SCONE_CONFIG_ID
version: "0.3"

services:
  - name: api_service
    image_name: python_image
    command: /venv/bin/python3 /app/app.py
    mrenclaves: [$MRENCLAVE]
    fspf_path: /fspf/fspf.pb
    fspf_key: $FSPF_KEY
    fspf_tag: $FSPF_TAG
    environment:
      PLAIN_HTTP: $PLAIN_HTTP
      SERVER_PORT: $SERVER_PORT
      INCLUDE_USAGE_STATISTICS: $INCLUDE_USAGE_STATISTICS
      USAGE_STATISTICS_MAX_SAMPLES: $USAGE_STATISTICS_MAX_SAMPLES
      AUTH_USERNAME: $AUTH_USERNAME
      AUTH_PASSWORD: $AUTH_PASSWORD
      PUBLIC_OPENEHR_API_BASE_URI: $PUBLIC_OPENEHR_API_BASE_URI
      PRIVATE_OPENEHR_API_BASE_URI: $PRIVATE_OPENEHR_API_BASE_URI
      OPENEHR_API_AUTH_USERNAME: $OPENEHR_API_AUTH_USERNAME
      OPENEHR_API_AUTH_PASSWORD: $OPENEHR_API_AUTH_PASSWORD
      VALIDATE_OPENEHR_API_CERTIFICATE: $VALIDATE_OPENEHR_API_CERTIFICATE
      USE_CUSTOM_OPENEHR_API_CA_CERTIFICATE: $USE_CUSTOM_OPENEHR_API_CA_CERTIFICATE
      PUBLIC_DEMOGRAPHIC_API_BASE_URI: $PUBLIC_DEMOGRAPHIC_API_BASE_URI
      PRIVATE_DEMOGRAPHIC_API_BASE_URI: $PRIVATE_DEMOGRAPHIC_API_BASE_URI
      DEMOGRAPHIC_API_AUTH_USERNAME: $DEMOGRAPHIC_API_AUTH_USERNAME
      DEMOGRAPHIC_API_AUTH_PASSWORD: $DEMOGRAPHIC_API_AUTH_PASSWORD
      VALIDATE_DEMOGRAPHIC_API_CERTIFICATE: $VALIDATE_DEMOGRAPHIC_API_CERTIFICATE
      USE_CUSTOM_DEMOGRAPHIC_API_CA_CERTIFICATE: $USE_CUSTOM_DEMOGRAPHIC_API_CA_CERTIFICATE

security:
  attestation:
    tolerate:
      [
        debug-mode,
        hyperthreading,
        outdated-tcb,
        insecure-igpu,
        software-hardening-needed,
        insecure-configuration,
      ]
    ignore_advisories: "*"
